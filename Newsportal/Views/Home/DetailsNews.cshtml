@model Newsportal.Models.News


@{
    ViewData["Title"] = @Model.Title;
    Layout = "_Layout";
}
@{
    var cls = @Model.UserLikes ? "btn btn-primary" : "btn btn-secondary";
}
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8">
            <!-- Post content-->
            <article>
                <!-- Post header-->
                <header class="mb-4">
                    <!-- Post title-->
                    <h1 class="fw-bolder mb-1">@Model.Title</h1>
                    <div class="d-flex justify-content-end "><p class="border border-info bg-danger text-white">Read Counts: @Model.Count</p></div>
                    <!-- Post meta content-->
                    <div class="text-muted fst-italic mb-2">Posted on @Model.PublishedDate.Month/@Model.PublishedDate.Day @Model.PublishedDate.Hour:@Model.PublishedDate.Minute by @Model.Reporter.FirstName @Model.Reporter.LastName</div>
                    <!-- Post categories-->
                    <a class="badge bg-info text-white text-decoration-none link-light" href="#!">@Model.Category.CategoryName</a>
                </header>
                <!-- Preview image figure-->
                @if (@Model.Image != null)
                {
                    <figure class="mb-4"><img class="img-fluid rounded" src="@Model.Image" alt="..."></figure>
                }

                <!-- Post content-->
                <section class="mb-5">
                    @Html.Raw(Model.Content)
                </section>
                <!--End -->
                <!--Likes and rating section-->
                <div class="d-flex justify-content-around mb-3">
                    <!--Likes section-->
                    <p class="my-3">
                        <p id="totalLikes">@Model.TotalLikes</p> <button class="@cls" onclick="likeNews()" id="likeButton">Likes</button>
                    </p>
                    <!--Rating section-->
                    <p class=" my-3">
                        <p id="totalRating">@Model.Rating</p> Rating
                    </p>
                </div>
                <!--End-->

                
            </article>
            <!-- Comments section-->
            @*<section class="mb-5">
                <div class="card bg-light">
                    <div class="card-body">
                        <!-- Comment form-->
                        <form class="mb-4">
                            <textarea class="form-control" rows="3" placeholder="Join the discussion and leave a comment!"></textarea>
                            <button type="submit" id="commentButton" class="btn btn-primary">Comment</button>
                        </form>
                        @foreach (var comment in Model.Comments)
                        {
                            <!-- Comment with nested comments-->
                            <div class="d-flex mb-4">
                            <!-- Parent comment-->
                            <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..."></div>
                            <div class="ms-3">
                            <div class="fw-bold">@comment.CommentedBy.FirstName @comment.CommentedBy.LastName</div>
                            <p>HERE SHOULD BE THE ACTUAL COMMENT: @comment.Content</p>
                            @if (comment.Replies.Any())
                            {
                                foreach (var reply in comment.Replies)
                                {
                                    <!-- Child comment 1-->
                                    <div class="d-flex mt-4">
                                        <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..."></div>
                                        <div class="ms-3">
                                            <div class="fw-bold">@reply.CommentedBy.FirstName @reply.CommentedBy.FirstName</div>
                                            <p>HERE SHOULD BE THE COMMENT REPLY: @reply.Content</p>
                                        </div>
                                        @if (comment.Replies.Any())
                                        {
                                            foreach (var rep in reply.Replies)
                                            {
                                                <!-- Child comment 1-->
                                                <div class="d-flex mt-4">
                                                    <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..."></div>
                                                    <div class="ms-3">
                                                        <div class="fw-bold">@rep.CommentedBy.FirstName @rep.CommentedBy.FirstName</div>
                                                        <p>HERE SHOULD BE THE COMMENT REPLY: @rep.Content</p>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                }
                            }
                                <!-- Child comment 2-->
                                <div class="d-flex mt-4">
                                    <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..."></div>
                                    <div class="ms-3">
                                        <div class="fw-bold">Commenter Name</div>
                                        When you put money directly to a problem, it makes a good headline.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Single comment-->
                        <div class="d-flex">
                            <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..."></div>
                            <div class="ms-3">
                                <div class="fw-bold">Commenter Name</div>
                                When I look at the universe and all the ways the universe wants to kill us, I find it hard to reconcile that with statements of beneficence.
                            </div>
                        </div>
                    }
                    </div>
                </div>
            </section>*@
        </div>
        <!-- Side widgets-->
        <div class="col-lg-4">
            <!-- Search widget-->
            <div class="card mb-4">
                <div class="card-header">Search</div>
                <div class="card-body">
                    <div class="input-group">
                        <input class="form-control" type="text" placeholder="Enter search term..." aria-label="Enter search term..." aria-describedby="button-search">
                        <button class="btn btn-primary" id="button-search" type="button">Go!</button>
                    </div>
                </div>
            </div>
            <!-- Categories widget-->
            <div class="card mb-4">
                <div class="card-header">Categories</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <ul class="list-unstyled mb-0">
                                <li><a href="#!">National</a></li>
                                <li><a href="#!">International</a></li>
                                <li><a href="#!">Politics</a></li>
                            </ul>
                        </div>
                        <div class="col-sm-6">
                            <ul class="list-unstyled mb-0">
                                <li><a href="#!">Fashon</a></li>
                                <li><a href="#!">Economy</a></li>
                                <li><a href="#!">Sports</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Side widget-->
            <div class="card mb-4">
                <div class="card-header">Side Widget</div>
                <div class="card-body">You can put anything you want inside of these side widgets. They are easy to use, and feature the Bootstrap 5 card component!</div>
            </div>
        </div>
    </div>
</div>

<div>

    <a asp-action="Index">Back to List</a>
</div>

@section Scripts
{
    <script type="text/javascript">
        function likeNews() {
            let likesElement = $("#totalLikes");
            let totalLikes = parseInt(likesElement.text());
            console.log(totalLikes);
            const newsId = @Model.Id;
            
            const url = '@Url.Action("LikeNews", "News")' + '?newsId=' + newsId;
            console.log(url);
            $.ajax({
                url: url,
                contentType: 'application/html; charset=utf-8',
                type: 'POST',
                beforeSend: function () {
                },
                success: function (result) {
                    console.log(result);
                    likesElement.text(result?.totalLikes)
                    if (result.isLiked === true){
                        $("#likeButton").attr("class", "btn btn-primary");    
                    }else {
                        $("#likeButton").attr("class", "btn btn-secondary");
                    }
                    
                    
                },
                error: function (errorResponse) {
                    console.log(errorResponse)
                }
            });
            
        }
        
        $(document).ready(() => listComment(@Json.Serialize(Model.Comments)));
        
        const listComment = comments => {
            console.log(comments);
        }
        
    </script>

}
